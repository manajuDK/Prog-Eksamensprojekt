@page "/"
@inject NavigationManager NavManager

<PageTitle>Blazor Poker Nights - Index</PageTitle>

<h3>Playercount: @count/5</h3>

<div>
	@for (int i = 0; i < count; i++)
	{
		<UserCreator id=i TItem="int" userRemoved="RemoveUserComp" @ref=Comps[i]></UserCreator>
	}
	<button class="PlusButton" @onclick="CountUp">+</button>
	<button class="PlusButton" @onclick="CountDown">-</button>
	<div class="ErrorText">
		@if (maxCountError)
		{
			<p style="color: red">There is already the maximum amount of players in the game!</p>
		}
	</div>
</div>

<div class="StartButton">
	@if (displayErrMsg)
	{
		<p style="color: red">@errMsg</p>
	}
	<button @onclick="StartGame">Start</button>
</div>

<style>
	.PlusButton {
		width: 70px;
		height: 70px;
		font-size: 25px;
		background: white;
		border-radius: 70px;
		float: left;
		margin-left: 8px;
		margin-top: 20px;
	}
	.ErrorText {
		float: left;
	}
	.StartButton {
		position: absolute;
		top: 90%;
		right: 10%;
		display: inline-block;
	}
</style>

@code {
	int count = 1;
	Boolean maxCountError = false;

	string errMsg = "";
	Boolean displayErrMsg = false;

	List<UserCreator<int>> Comps = new List<UserCreator<int>>(new UserCreator<int>[5]);

	protected override async Task OnInitializedAsync()
	{
		//Create first user
		Shared.GlobalInfo.userList.Add(new User());
	}
	private void CountUp()
	{
		if (count < 5)
		{
			count++;
			Shared.GlobalInfo.userList.Add(new User());
		} else
		{
			maxCountError = true;
		}
	}
	public async void RemoveUserComp(int id)
	{
		count--;
		for (int i = id; i < Comps.Count; i++)
		{
			Comps[i].id = Comps[i].id - 1;
		}
	}
	private void CountDown()
	{
		if (count > 0)
		{
			count--;
			Shared.GlobalInfo.userList.RemoveAt(Shared.GlobalInfo.userList.Count);
		}
	}
	private void StartGame()
	{
		//Check if all inputs are valid before starting game
		errMsg = "";
		for (int i = 0; i < Shared.GlobalInfo.userList.Count; i++)
		{
			if (Shared.GlobalInfo.userList[i].name == "")
			{
				errMsg = "All players must have a name";
				Console.WriteLine(errMsg);
			}
			if (Shared.GlobalInfo.userList[i].startBalance <= 0)
			{
				errMsg = "The starting balance must be above 0";
				Console.WriteLine(errMsg);
			}
		}
		if (errMsg == "")
		{
			NavManager.NavigateTo("/gamepage");
		} else
		{
			displayErrMsg = true;
		}
	}
}

